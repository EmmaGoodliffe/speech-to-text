parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"uCOr":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(r){i(r)}}function a(e){try{u(n.throw(e))}catch(r){i(r)}}function u(e){var r;e.done?o(e.value):(r=e.value,r instanceof t?r:new t(function(e){e(r)})).then(s,a)}u((n=n.apply(e,r||[])).next())})},r=this&&this.__generator||function(e,r){var t,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=r.call(e,s)}catch(a){i=[6,a],n=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.recExp=exports.getWavHeaders=exports.runBashScript=exports.useSpinner=exports.relPathToAbs=void 0;var t=require("child_process"),n=require("path"),o="_";exports.relPathToAbs=function(e){return n.resolve(n.dirname(""),e)},exports.useSpinner=function(t,n,o,i){return void 0===o&&(o="Done"),void 0===i&&(i="Failed"),e(void 0,void 0,Promise,function(){var e,s;return r(this,function(r){switch(r.label){case 0:n.start(),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,t];case 2:return e=r.sent(),n.succeed(o),[2,e];case 3:throw s=r.sent(),n.fail(i),s;case 4:return[2]}})})},exports.runBashScript=function(e){return new Promise(function(r,n){t.exec(e,function(e,t,i){e&&((""+i).includes("'.' is not recognized as an internal or external command")?n("An error occurred running a bash script. If you are using windows, please use WSL. See "+o+" for more details"+". "+e):n(e));i&&i.length&&n(i),r(t)})})},exports.getWavHeaders=function(t){return e(void 0,void 0,Promise,function(){var e,n,o,i,s,a,u;return r(this,function(r){switch(r.label){case 0:return e="./headers.sh "+t,[4,exports.runBashScript(e)];case 1:return n=r.sent(),o=n.replace("\n","").toUpperCase().split(","),i=o[0],s=o[1],a=i,u=parseInt(s),[2,{encoding:a,sampleRateHertz:u}]}})})},exports.recExp=function(e,r,t){return"Received "+e+" "+r+" but expected "+t};
},{}],"RC6V":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}u((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(s){i=[6,s],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@google-cloud/speech"),a=require("fs"),i=n(require("ora")),o=require("./helpers"),s="STT stream running...",u="STT stream done",c="STT stream failed",l="https://cloud.google.com/speech-to-text/docs/error-messages",p=function(){function n(e,t,n){this.audioFilename=e,this.textFilename=t,this.append=n.append||!1,this.encoding=n.encoding||"LINEAR16",this.sampleRateHertz=n.sampleRateHertz,this.languageCode=n.languageCode||"en-GB"}return n.prototype.testHeaders=function(){return e(this,void 0,Promise,function(){var e,n,r;return t(this,function(t){switch(t.label){case 0:return[4,o.getWavHeaders(this.audioFilename)];case 1:return e=t.sent(),n=this.encoding===e.encoding,r=this.sampleRateHertz===e.sampleRateHertz,[2,[n,r,e]]}})})},n.prototype.start=function(n){return void 0===n&&(n=!0),e(this,void 0,Promise,function(){var e,r,a,l,p,d,h;return t(this,function(t){switch(t.label){case 0:return[4,this.testHeaders()];case 1:return e=t.sent(),r=e[0],a=e[1],l=e[2],p="Warning: Your audio encoding and sample rate might not be correct",r||(d=o.recExp("encoding",this.encoding,l.encoding),console.warn(p+". "+d)),a||(d=o.recExp("sample rate (Hertz)",this.sampleRateHertz,l.sampleRateHertz),console.warn(p+". "+d)),h=[],n?[4,o.useSpinner(this.inner(),i.default(s),u,c)]:[3,3];case 2:return h=t.sent(),[3,5];case 3:return[4,this.inner()];case 4:h=t.sent(),t.label=5;case 5:return[2,h]}})})},n.prototype.inner=function(){var e=this;return new Promise(function(t,n){var i=[];e.append||a.writeFileSync(e.textFilename,"");var o=new r.SpeechClient,s={config:{encoding:e.encoding,sampleRateHertz:e.sampleRateHertz,languageCode:e.languageCode}},u=a.createReadStream(e.audioFilename),c=o.streamingRecognize(s).on("error",function(e){var t=["An error occurred running the STT stream. "+e,"See "+l+" for help on common error messages"].join("\n");n(t)}).on("data",function(t){var r=t.results[0].alternatives[0].transcript;i.push(r),a.appendFile(e.textFilename,r+"\n",function(e){e&&n("An error occurred writing to the text file. "+e)})}).on("end",function(){return t(i)});u.pipe(c)})},n}();exports.default=p;
},{"./helpers":"uCOr"}],"GR1A":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(s,i){function o(e){try{u(n.next(e))}catch(t){i(t)}}function a(e){try{u(n.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}u((n=n.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var r,n,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(s=2&i[0]?n.return:i[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(a){i=[6,a],n=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("fs"),s=require("path"),i=require("./helpers"),o=r(require("./STTStream")),a=n.promises.readdir,u=300,c=function(){function r(e,t,r,n){this.audioFilename=e,this.audioDirname=t,this.textFilename=r,this.options=n,this.progress=0,this.progressListeners=[],this.distributeListeners=[]}return r.prototype.setProgress=function(r){return e(this,void 0,Promise,function(){var e,n;return t(this,function(t){switch(t.label){case 0:this.progress=r,e=0,n=this.progressListeners,t.label=1;case 1:return e<n.length?[4,(0,n[e])(r)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},r.prototype.on=function(e,t){"progress"===e?this.progressListeners.push(t):"distribute"===e&&this.distributeListeners.push(t)},r.prototype.distribute=function(){return e(this,void 0,Promise,function(){var e,r,n,s,o,a,c,l,h,f,p,d,b,y,g;return t(this,function(t){switch(t.label){case 0:e="./distribute.sh "+this.audioFilename+" "+this.audioDirname+" "+u,r="",t.label=1;case 1:return t.trys.push([1,3,,4]),[4,i.runBashScript(e)];case 2:return r=t.sent(),[3,4];case 3:if(n=t.sent(),o=[/End position is after expected end of audio/i,/Last 1 position\(s\) not reached/i],s=""+n)for(a=s.split("\n"),c=0,l=a;c<l.length;c++){for(h=l[c],f=!1,p=0,d=o;p<d.length;p++)b=d[p],f=f||b.test(h);if(!f&&h.length)throw h}return[3,4];case 4:y=0,g=this.distributeListeners,t.label=5;case 5:return y<g.length?[4,(0,g[y])()]:[3,8];case 6:t.sent(),t.label=7;case 7:return y++,[3,5];case 8:return[2,r]}})})},r.prototype.start=function(r){return e(this,void 0,Promise,function(){var e,n,i,u,c,l,h,f,p,d,b,y,g,m;return t(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.distribute()];case 1:return(e=t.sent()).length&&console.log("Distribute script: "+e),[3,3];case 2:throw"An error occurred distributing the audio file. "+t.sent();case 3:return[4,a(this.audioDirname)];case 4:for(h in n=t.sent(),i=/\.wav$/,u=n.filter(function(e){return i.test(e)}),c=u.length,l=[],u)l.push(h);f=0,t.label=5;case 5:return f<l.length?(p=l[f],d=parseInt(p),b=u[p],y=s.resolve(this.audioDirname,b),g=new o.default(y,this.textFilename,this.options),m=~~(d/c*100),[4,this.setProgress(m)]):[3,9];case 6:return t.sent(),[4,g.start(r)];case 7:t.sent(),t.label=8;case 8:return f++,[3,5];case 9:return[4,this.setProgress(100)];case 10:return t.sent(),[2]}})})},r.prototype.emptyTextFile=function(){n.writeFileSync(this.textFilename,"")},r}();exports.default=c;
},{"./helpers":"uCOr","./STTStream":"RC6V"}],"QCba":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("./DistributedSTTStream")),r=require("./helpers"),s="./lgim-stt-key.json",o=r.relPathToAbs(s);process.env.GOOGLE_APPLICATION_CREDENTIALS=o;var i=new t.default("input.wav","./audio_dist","text.txt",{append:!0,sampleRateHertz:48e3});i.emptyTextFile(),i.on("distribute",function(){return console.log("Distributed")}),i.on("progress",console.log),i.start().catch(console.error);
},{"./DistributedSTTStream":"GR1A","./helpers":"uCOr"}]},{},["QCba"], null)
//# sourceMappingURL=/index.js.map