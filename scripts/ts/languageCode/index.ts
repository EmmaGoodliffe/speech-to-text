import fetch from "node-fetch";
import { writeFileSync } from "fs";

const LANG_CODE_URL =
  "https://cloud.google.com/speech-to-text/docs/common/languages.json";
const DOC_COMMENT = `
/**
 * Language code
 * @remarks
 * See https://cloud.google.com/speech-to-text/docs/languages
 * @public 
 */`;

type Record = string[];

type Data = [Title[], ...Record[]];

interface Title {
  label: string;
  value: string;
}

const main = async () => {
  const response = await fetch(LANG_CODE_URL);
  const data = (await response.json()) as Data;
  const records = data.slice(1) as Record[];
  const codes = records.map(record => record[1]);
  const str = JSON.stringify(codes)
    .replace(/(\[|\])/g, "")
    .replace(/,/g, "|");
  const text = `// Do not edit directly. Generated by scripts/ts/LanguageCode/index.ts
  ${DOC_COMMENT}
  export type LanguageCode = ${str};`;
  writeFileSync("./scripts/ts/languageCode/output/LanguageCode.ts", text);
};

main().catch(console.error);
